<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hangout Confirmation</title>
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <!-- SweetAlert2 CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
    <!-- Pace.js CSS -->
    <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/themes/black/pace-theme-loading-bar.min.css">
    <!-- Custom Styles -->
    <style>
        body {
            background-color: #ffe4e1;
            /* Light pink background */

            font-family: "Comic Sans MS", cursive, sans-serif;
            font-size: 27px;
            letter-spacing: -0.2px;
            word-spacing: 2.2px;
            color: #ED164F;
            font-weight: 700;
            text-decoration: none;
            font-style: normal;
            font-variant: normal;
            text-transform: none;
        }

        .pace .pace-progress {
            background: #ff69b4;
            /* Hot pink color for the loading bar */
        }

        .pace .pace-active {
            border: 2px solid #ff69b4;
            /* Pink border color when active */
        }

        .pace-done .pace-overlay {
            display: none !important;
        }

        .pace-overlay {
            background-color: #ff69b4;
        }

        .pace-overlay {
            z-index: 100;
        }

        .pace-overlay {
            width: 100%;
            height: 100%;
            background-color: #ff69b4;
            position: fixed;
            top: 0;
            left: 0;
            z-index: 1;
        }

        .btn-size {
            transition: transform 0.3s ease;
        }

        .no-btn {
            position: relative;
        }

        .final-text {
            text-align: center;
            margin-top: 50px;
            color: #ff6699;
        }

        .food-selection,
        .date-picker {
            display: none;
        }

        .food-selection {
            text-align: center;
        }

        .food-images {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 20px;
        }

        .food-image {
            width: 100px;
            height: 100px;
            transition: all 0.3s ease;
            cursor: pointer;
            border: 2px solid transparent;
        }

        .food-image:hover {
            transform: scale(1.1);
        }

        .food-image.selected {
            width: 150px;
            height: 150px;
            /* border: 2px solid blue; */
        }

        #chooseFoodBtn {
            margin-top: 20px;
        }

        #kissingGif {
            max-width: 100%;
            height: auto;
        }

        .swal2-popup {
            background-color: #ffe4e1 !important;
            /* Light pink background */
        }

        .swal2-title {
            color: #ff69b4 !important;
            /* Hot pink title text */
        }

        .swal2-confirm {
            background-color: #ff69b4 !important;
            /* Hot pink confirm button */
        }

        .swal2-cancel {
            background-color: #ff99cc !important;
            /* Lighter pink cancel button */
        }
    </style>
</head>

<body>
    <div class="pace-overlay"></div>
    <div class="container d-flex justify-content-center align-items-center text-center" style="height: 100vh;">
        <div class="question">
            <h2><strong>Can you hang out on a date?</strong></h2>
            <button class="btn btn-success btn-yes">Yes</button>
            <button class="btn btn-danger btn-no no-btn">No</button>
        </div>

        <div class="date-picker mt-4">
            <h3><strong>Pick a Date & Time</strong></h3>
            <input type="datetime-local" id="dateTimeInput" class="form-control" />
            <button id="confirmDateBtn" class="btn btn-success mt-2">Submit</button>
        </div>

        <div class="food-selection mt-4">
            <h4><strong>Choose Your Fast Food</strong></h4>
            <form id="foodSelectionForm">
                <div class="container">
                    <div class="row">
                        <div class="col-6 col-md-4 col-lg-3 mb-3">
                            <img src="https://i.pinimg.com/736x/e8/fe/72/e8fe723cbff8b416ca7dd17e3cb20d45.jpg"
                                alt="Jollibee" class="food-image img-fluid" data-value="Jollibee">
                        </div>
                        <div class="col-6 col-md-4 col-lg-3 mb-3">
                            <img src="https://bcassetcdn.com/public/blog/wp-content/uploads/2021/10/21194000/McDonalds.png"
                                alt="McDonald's" class="food-image img-fluid" data-value="Mcdo">
                        </div>
                        <div class="col-6 col-md-4 col-lg-3 mb-3">
                            <img src="https://d1yjjnpx0p53s8.cloudfront.net/styles/logo-thumbnail/s3/0015/0927/brand.gif?itok=DW4HkcxM"
                                alt="McDollibee" class="food-image img-fluid" data-value="Mcdollibee">
                        </div>
                        <div class="col-6 col-md-4 col-lg-3 mb-3">
                            <img src="https://bcassetcdn.com/public/blog/wp-content/uploads/2021/10/21194004/KFC.png"
                                alt="KFC" class="food-image img-fluid" data-value="KFC">
                        </div>
                        <div class="col-6 col-md-4 col-lg-3 mb-3">
                            <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRqeF7xOho0NM-xopPMV0JtQY0fr9xIzJqHfg&s"
                                alt="Chowking" class="food-image img-fluid" data-value="Chowking">
                        </div>
                        <div class="col-6 col-md-4 col-lg-3 mb-3">
                            <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRHmZAojaIR-WyRddNzvNhdcYO33PPpteiTuQ&s"
                                alt="Mang Inasal" class="food-image img-fluid" data-value="Mang Inasal">
                        </div>
                        <div class="col-6 col-md-4 col-lg-3 mb-3">
                            <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTUMq3CcD_ifoulgFYSjZfbSxuTkieR8D1NJQ&s"
                                alt="Bon Chon" class="food-image img-fluid" data-value="Bon Chon">
                        </div>
                        <div class="col-6 col-md-4 col-lg-3 mb-3">
                            <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSVr8kgCpD6mD5tHSBRysvWHSL3myOYAyeS3rb4lY-gzOlDcvHcVpzHZg14ZKbVj0tyeJo&usqp=CAU"
                                alt="Tokyo Tokyo" class="food-image img-fluid" data-value="Tokyo Tokyo">
                        </div>
                        <div class="col-6 col-md-4 col-lg-3 mb-3">
                            <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQUWLBoCT-SPYJyOmHFcjx4mA5NT5H2bitrsQ&s"
                                alt="Greenwich" class="food-image img-fluid" data-value="Greenwich">
                        </div>
                        <div class="col-6 col-md-4 col-lg-3 mb-3">
                            <img src="https://i.pinimg.com/736x/ca/38/ca/ca38cabfc7f07d97a422859b91df07cd.jpg"
                                alt="Burger King" class="food-image img-fluid" data-value="Burger King">
                        </div>
                    </div>
                </div>

                <input type="hidden" id="selectedFood" name="selectedFood" value="">
            </form>
            <button id="chooseFoodBtn" class="btn btn-primary">Choose</button>
        </div>

        <div class="final-text d-none" id="finalMessage">
            <img id="kissingGif" src="https://gifdb.com/images/high/bear-hug-kiss-bubu-dudu-pdyvjfqgohc9pk18.webp"
                alt="Kissing GIF">
            <p>I love you so much and can't wait to see you!</p>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4"></script>
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js"></script>
    <script>
        $(document).ready(function () {
            let btnSize = 1;

            // Array of different "No" button messages
            const noButtonMessages = [
                "Mahal please :(",
                "please please please",
                "I want to see you badly!",
                "I'm begging you :(, don't say no!",
                "Please, you're breaking my heart :( come with me!",
                "I miss you so much, please let's hang out!",
                "One chance! Please please please!",
                "How can you resist me? :( I want to see you badly!",
                "Pretty please, I need you :(",
                "It would mean the world to me if you said yes!"
            ];

            let noClickCount = 0;

            // Handle No button click
            $('.btn-no').click(function () {
                const newMessage = noButtonMessages[noClickCount % noButtonMessages.length];
                $(this).text(newMessage);

                // Increment the size of the Yes button
                $('.btn-yes').addClass('btn-size').css('transform', 'scale(' + (btnSize += 0.5) + ')');

                noClickCount++;
            });

            // Handle Yes button click
            $('.btn-yes').click(function () {
                $('.question').fadeOut();
                $('.date-picker').fadeIn();
            });

            // Handle Date Picker submit
            $('#confirmDateBtn').click(function () {
                const selectedDateInput = document.getElementById('dateTimeInput');
                const selectedDate = selectedDateInput.value;

                if (selectedDate) {
                    Swal.fire({
                        title: 'Confirm Date & Time',
                        text: 'Are you sure you want to hang out on this date?',
                        icon: 'question',
                        showCancelButton: true,
                        confirmButtonColor: '#ff69b4',  // Custom pink color for "Yes"
                        cancelButtonColor: '#ff99cc',  // Lighter pink color for "No"
                        confirmButtonText: 'Yes!',
                        cancelButtonText: 'No, change it'
                    }).then((result) => {
                        if (result.isConfirmed) {
                            // Hide Date Picker and show Fast Food Selection
                            $('.date-picker').fadeOut();
                            $('.food-selection').fadeIn();
                        }
                    });
                } else {
                    Swal.fire({
                        html: "<h3><b>Please select a Date & Time!</b><h3>",
                        icon: 'warning',
                        showCancelButton: false,
                        confirmButtonColor: '#ff69b4',  // Custom pink color for "Yes"
                        confirmButtonText: 'Ok',
                    })
                }

            });
        });
    </script>

    <script>
        const images = document.querySelectorAll('.food-image');
        const selectedFoodInput = document.getElementById('selectedFood');

        images.forEach(image => {
            image.addEventListener('click', () => {
                // Remove selected class from all images
                images.forEach(img => img.classList.remove('selected'));

                // Add selected class to the clicked image
                image.classList.add('selected');

                // Update the hidden input with the selected food value
                selectedFoodInput.value = image.getAttribute('data-value');
            });
        });
    </script>

    <script type="module">
        // Import the Firebase library
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-app.js";
        import { getDatabase, ref, child, get, set } from 'https://www.gstatic.com/firebasejs/10.14.0/firebase-database.js';
        // TODO: Add SDKs for Firebase products that you want to use
        // https://firebase.google.com/docs/web/setup#available-libraries

        // Your web app's Firebase configuration
        // For Firebase JS SDK v7.20.0 and later, measurementId is optional
        const firebaseConfig = {
            apiKey: "AIzaSyDnwHdnDa4Dk8jBGopYKYqYR-Pw53T9z58",
            authDomain: "dateme-fe6f1.firebaseapp.com",
            projectId: "dateme-fe6f1",
            databaseURL: "https://dateme-fe6f1-default-rtdb.asia-southeast1.firebasedatabase.app/",
            storageBucket: "dateme-fe6f1.appspot.com",
            messagingSenderId: "361396895905",
            appId: "1:361396895905:web:d04c8be8a60495429d70e0",
            measurementId: "G-KQ0DGHXRVH"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        // Get a reference to the "questions" node
        const questionsRef = ref(db, "questions");

        // Get a reference to the "answers" node
        const answersRef = ref(db, "answers");

        // Get a reference to the current user's answers node (e.g., "user1")
        const userAnswersRef = child(answersRef, "user1");

        // Initialize variables
        let currentQuestion = 0;
        let userAnswers = {};

        // Function to display the next question
        function displayNextQuestion() {
            // Get the current question from the database
            get(child(questionsRef, currentQuestion.toString())).then((snapshot) => {
                if (snapshot.exists()) {
                    const question = snapshot.val();
                    // Display the question
                    $(".question").html(question);
                    // Increment the current question index
                    currentQuestion++;
                } else {
                    // console.log("No more questions available.");
                }
            }).catch((error) => {
                console.error(error);
            });
        }

        // Function to handle the user's answer
        function handleAnswer(answer) {
            // Save the user's answer to the database
            set(child(userAnswersRef, (currentQuestion - 1).toString()), answer)
                .then(() => {
                    // Display the next question
                    displayNextQuestion();
                })
                .catch((error) => {
                    console.error("Error saving answer: ", error);
                });
        }

        // Function to handle the user's date and time selection
        function handleDateTimeSelection() {
            const dateTime = $("#dateTimeInput").val(); // Get the user's selected date and time
            set(child(userAnswersRef, "dateTime"), dateTime)
                .then(() => {
                    // Display the next question
                    displayNextQuestion();
                })
                .catch((error) => {
                    console.error("Error saving date and time: ", error);
                });
        }

        // Function to handle the user's food selection
        function handleFoodSelection() {
            const food = $(".food-image.selected").attr("alt"); // Get the user's selected food
            set(child(userAnswersRef, "food"), food)
                .then(() => {
                    // Display the final message
                    const selectedFoodInput = document.getElementById('selectedFood');
                    const selectedFood = selectedFoodInput.value;
                    // Show SweetAlert for Fast Food confirmation
                    if (selectedFood) {
                        Swal.fire({
                            title: 'Are you sure?',
                            text: "Are you sure about your " + selectedFood + " fast food choice?",
                            icon: 'question',
                            showCancelButton: true,
                            confirmButtonColor: '#ff69b4',  // Custom pink color for "Yes"
                            cancelButtonColor: '#ff99cc',  // Lighter pink color for "No"
                            confirmButtonText: 'Yes, proceed!',
                            cancelButtonText: 'No, choose again'
                        }).then((result) => {
                            if (result.isConfirmed) {
                                // Hide the Fast Food selection after confirming
                                $('.food-selection').fadeOut();

                                // Reset fast food selection (assuming it's a select input)
                                $('#foodSelectionForm select').val(''); // Clear fast food choice

                                // Show the final message
                                $('#finalMessage').removeClass('d-none').fadeIn(); // Show final message with smooth fade-in
                                $('#kissingGif').fadeIn();

                                displayFinalMessage();
                            }
                        });
                    } else {
                        Swal.fire({
                            html: "<h3><b>Please select a fast food!</b><h3>",
                            icon: 'warning',
                            showCancelButton: false,
                            confirmButtonColor: '#ff69b4',  // Custom pink color for "Yes"
                            confirmButtonText: 'Ok',
                        })
                    }
                })
                .catch((error) => {
                    console.error("Error saving food selection: ", error);
                });
        }

        // Function to display the final message
        function displayFinalMessage() {
            get(userAnswersRef).then((snapshot) => {
                if (snapshot.exists()) {
                    const answers = snapshot.val();

                    const date = new Date(answers.dateTime);

                    const options = { year: 'numeric', month: 'long', day: 'numeric', hour: '2-digit', minute: '2-digit', hour12: true };
                    const formattedDate = date.toLocaleString('en-US', options);

                    // Display the final message
                    $("#finalMessage").append("You chose to hang out on " + formattedDate  + " and eat " + answers.food + "!");
                    // Display the kissing gif
                    // $("#kissingGif").show();
                } else {
                    console.log("No answers available.");
                }
            }).catch((error) => {
                console.error("Error fetching answers: ", error);
            });
        }

        // Event listeners for buttons
        $(".btn-yes").on("click", () => handleAnswer("yes"));
        $(".btn-no").on("click", () => handleAnswer("no"));
        $("#confirmDateBtn").on("click", () => handleDateTimeSelection());
        $("#chooseFoodBtn").on("click", () => handleFoodSelection());

        // Initialize the app by displaying the first question
        displayNextQuestion();
    </script>
</body>

</html>
